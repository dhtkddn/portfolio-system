# Portfolio System

**5λ‹¨κ³„ μ„ν—μ„±ν–¥ κΈ°λ° AI ν¬νΈν΄λ¦¬μ¤ μ¶”μ² μ‹μ¤ν…**

> HyperCLOVA Xμ™€ PostgreSQLμ„ ν™μ©ν• μ§€λ¥ν• ν¬μ μλ¬Έ ν”λ«νΌ

ν•κµ­ μ£Όμ‹μ‹μ¥(KOSPI/KOSDAQ) μ‹¤μ  λ°μ΄ν„°λ¥Ό κΈ°λ°μΌλ΅ 5λ‹¨κ³„ μ„ν—μ„±ν–¥ λ¶„λ¥μ— λ”°λ¥Έ κ°μΈ λ§μ¶¤ν• ν¬νΈν΄λ¦¬μ¤λ¥Ό μ¶”μ²ν•λ” μ™„μ „ μλ™ν™”λ AI μ‹μ¤ν…μ…λ‹λ‹¤.

##  ν•µμ‹¬ κΈ°λ¥

###  5λ‹¨κ³„ μ„ν—μ„±ν–¥ μ‹μ¤ν…
- **μ•μ •ν•** (μ›κΈλ³΄μ „ μ°μ„ ) β†’ **μ•μ •μ¶”κµ¬ν•** (μ•μ •μ„±+μμµμ„±) β†’ **μ„ν—μ¤‘λ¦½ν•** (κ· ν•ν¬μ) β†’ **μ κ·Ήν¬μν•** (μ„±μ¥ν¬μ) β†’ **κ³µκ²©ν¬μν•** (κ³ μ„ν—κ³ μμµ)
- κ° λ‹¨κ³„λ³„ μμ‚°λ°°λ¶„ κ°€μ΄λ“λΌμΈ λ° μ„Ήν„° μ„ νΈλ„ μλ™ μ μ©
- μ‚¬μ©μ μ§λ¬Έ ν‚¤μ›λ“ μλ™ κ°μ§€λ΅ μ„ν—μ„±ν–¥ λ¶„λ¥ (μ: "μ κ·Ήμ μΈ", "κ³µκ²©μ μΈ", "μ•μ „ν•" λ“±)
- λ‹¨μΌ μΆ…λ© ν•λ„ μλ™ μ¤€μ (μ•μ •ν• 5% β†’ κ³µκ²©ν¬μν• 25%)

###  μ¬λ¬΄μ ν‘ κΈ°λ° μΆ…λ© μ¤ν¬λ¦¬λ‹
- **μ„ν—μ„±ν–¥λ³„ μ¬λ¬΄ κΈ°μ¤€ μ μ©**
  - μ•μ •ν•: λ§¤μ¶ 1000μ–µ μ΄μƒ, μμ—…μ΄μµλ¥  5% μ΄μƒ, μ μ μ μ™Έ
  - μ κ·Ήν¬μν•: μ„±μ¥μ„± μ¤‘μ‹, μμ—…μ΄μµλ¥  -5% μ΄μƒ
  - κ³µκ²©ν¬μν•: νμ‹ κΈ°μ—… ν¬ν•¨ν• κ΄‘λ²”μ„ν• μ„ λ³„
- **μμµμ„±/μ•μ •μ„±/μ„±μ¥μ„± μ§€ν‘ κΈ°λ° μ μν™”**
- **100% μ‹¤μ  DB λ°μ΄ν„° μ‚¬μ©** (λ¨μμ‘λ‹µ μ—†μ)

### AI κΈ°λ° ν¬νΈν΄λ¦¬μ¤ λ¶„μ„
- HyperCLOVA Xλ¥Ό ν™μ©ν• λ§μ¶¤ν• ν¬μ μ„¤λ…
- μ¬λ¬΄μ ν‘ κΈ°λ° μΆ…λ©λ³„ ν¬μ λ§¤λ ¥λ„ λ¶„μ„
- μ„ν—μ„±ν–¥λ³„ κ·Όκ±° μ μ‹ λ° κ°€μ΄λ“λΌμΈ μ¤€μ λ¶„μ„
- μ‹¤μ‹κ°„ μΆ…λ© μ„ λ³„ λ° μµμ ν™”

###  μ‹¤μ‹κ°„ λ°μ΄ν„° κΈ°λ° λ¶„μ„
- **PostgreSQL μ‹¤μ‹κ°„ μΆ…λ©/μ¬λ¬΄ λ°μ΄ν„°**
- **PyKRX, Yahoo Finance, DART API ν†µν•©**
- **μ‹¤μ  λ§¤μ¶μ•΅, μμ—…μ΄μµ, μ£Όκ°€ λ°μ΄ν„° μ‚¬μ©**
- μ¬λ¬΄μ ν‘ λΉ„κµ λ° νΈλ λ“ λ¶„μ„

## π”— API μ—”λ“ν¬μΈνΈ

### π― ν¬νΈν΄λ¦¬μ¤ λ¶„μ„
- `POST /api/v2/chat/enhanced` - **5λ‹¨κ³„ μ„ν—μ„±ν–¥ κΈ°λ° AI μƒλ‹΄**
  - μ‚¬μ©μ λ©”μ‹μ§€μ—μ„ μ„ν—μ„±ν–¥ μλ™ κ°μ§€
  - μ¬λ¬΄μ ν‘ μ¤ν¬λ¦¬λ‹ + ν¬νΈν΄λ¦¬μ¤ μƒμ„± + AI μ„¤λ…
  - λ‹¨μΌ μΆ…λ© ν•λ„ μλ™ μ μ©

- `POST /api/v2/portfolio/analyze` - **ν–¥μƒλ ν¬νΈν΄λ¦¬μ¤ λ¶„μ„**
  - λ‹¤μ¤‘ μµμ ν™” λ°©μ‹ μ§€μ› (μν•™μ /μ‹¤λ¬΄μ /λ³΄μμ )
  - 5λ‹¨κ³„ μ„ν—μ„±ν–¥λ³„ λ§μ¶¤ λ¶„μ„

- `POST /api/v2/portfolio/single` - **λ‹¨μΌ μµμ ν™” λ°©μ‹ λ¶„μ„**
  - νΉμ • μµμ ν™” λ°©μ‹μΌλ΅ ν¬νΈν΄λ¦¬μ¤ μƒμ„±
  - μ¬λ¬΄μ ν‘ λ°μ΄ν„° κΈ°λ° μΆ…λ© μ„ λ³„

- `POST /api/v2/portfolio/comparison` - **λ‹¤μ¤‘ μµμ ν™” λ°©μ‹ λΉ„κµ**
  - μν•™μ /μ‹¤λ¬΄μ /λ³΄μμ  λ°©μ‹ λ™μ‹ λΉ„κµ
  - μµμ  λ°©μ‹ μ¶”μ²

- `POST /api/v2/quick-recommendation` - **λΉ λ¥Έ ν¬νΈν΄λ¦¬μ¤ μ¶”μ²**
  - κ°„λ‹¨ν• μ…λ ¥μΌλ΅ μ¦‰μ‹ ν¬νΈν΄λ¦¬μ¤ μƒμ„±
  - μ΄λ³΄μμ© μΈν„°νμ΄μ¤

### π“ μ¬λ¬΄μ ν‘ λ¶„μ„
- `POST /api/v2/financial/comparison` - **κΈ°μ—…κ°„ μ¬λ¬΄μ ν‘ λΉ„κµ**
  - λ‹¤μ¤‘ κΈ°μ—… μ¬λ¬΄ λ°μ΄ν„° μ‹κ°ν™”
  - λ§¤μ¶/μμµμ„±/μ„±μ¥μ„± λΉ„κµ μ°¨νΈ
  - AI κΈ°λ° ν¬μ μΈμ‚¬μ΄νΈ μƒμ„±

- `GET /api/v2/financial/company/{ticker}` - **κ°λ³„ κΈ°μ—… μ¬λ¬΄ λ¶„μ„**
  - νΉμ • κΈ°μ—…μ μƒμ„Έ μ¬λ¬΄μ ν‘ λ°μ΄ν„°
  - μ—°λ„λ³„ νΈλ λ“ λ¶„μ„

### π® ν…μ¤νΈ λ° μ ν‹Έλ¦¬ν‹°
- `POST /test/optimizer` - **ν¬νΈν΄λ¦¬μ¤ μµμ ν™” μ—”μ§„ ν…μ¤νΈ**
  - λ‹¤μ–‘ν• μµμ ν™” λ°©μ‹ μ„±λ¥ λΉ„κµ
  - μ—”μ§„ μƒνƒ κ²€μ¦

- `GET /test/hyperclova` - **HyperCLOVA API μ—°κ²° ν…μ¤νΈ**
  - AI λ¨λΈ μ—°κ²° μƒνƒ ν™•μΈ

- `GET /api/optimization-modes` - **μµμ ν™” λ°©μ‹ μ •λ³΄**
  - μ‚¬μ© κ°€λ¥ν• μµμ ν™” μµμ… μ„¤λ…
  - μ„ν—μ„±ν–¥λ³„ μ¶”μ² λ°©μ‹

### π”§ μ‹μ¤ν… κ΄€λ¦¬
- `GET /health` - **μ„λ²„ μƒνƒ ν™•μΈ**
  - DB μ—°κ²°, API μƒνƒ μΆ…ν•© μ κ²€

- `GET /docs` - **API λ¬Έμ„ (Swagger UI)**
  - λ¨λ“  μ—”λ“ν¬μΈνΈ μƒμ„Έ λ¬Έμ„

## π€ λΉ λ¥Έ μ‹μ‘

### 1. ν™κ²½ μ„¤μ •
```bash
# κ°€μƒν™κ²½ μƒμ„±
conda env create -f environment.yml
conda activate portfolio

# ν™κ²½λ³€μ μ„¤μ • (.env νμΌ)
DB_URL="postgresql+psycopg2://user:password@host:port/dbname"
NCP_CLOVASTUDIO_API_KEY="your_api_key"
DART_API_KEY="your_dart_api_key"
```

### 2. λ°μ΄ν„°λ² μ΄μ¤ μ΄κΈ°ν™”
```bash
# λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ μƒμ„±
python scripts/init_db.py

# μ‹¤μ  λ°μ΄ν„° μμ§‘
python etl/load_yf.py      # μ£Όκ°€ λ°μ΄ν„°
python etl/load_dart.py    # μ¬λ¬΄μ ν‘ λ°μ΄ν„°
```

### 3. μ„λ²„ μ‹¤ν–‰
```bash
# API μ„λ²„ (ν¬νΈ 8008)
uvicorn app.main:app --host 0.0.0.0 --port 8008

# UI μ„λ²„ (Streamlit)
streamlit run portfolio_ui.py
```

## π”¬ ν…μ¤νΈ

### μ‹μ¤ν… κΈ°λ¥ ν…μ¤νΈ
```bash
# 5λ‹¨κ³„ μ„ν—μ„±ν–¥ μ‹μ¤ν… μ „μ²΄ ν…μ¤νΈ
python test_risk_profile_scenarios.py

# μ‹¤μ  μ‚¬μ©μ μ§λ¬Έ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ
python test_user_questions.py

# μ¬λ¬΄μ ν‘ μ¤ν¬λ¦¬λ‹ ν…μ¤νΈ
python test_financial_screening.py
```

### API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
```bash
# ν¬νΈν΄λ¦¬μ¤ μƒμ„± API ν…μ¤νΈ
curl -X POST "http://localhost:8008/api/v2/chat/enhanced" \
     -H "Content-Type: application/json" \
     -d '{"message": "μ κ·Ήμ μΈ ν¬μλ¥Ό μ›ν•©λ‹λ‹¤", "include_portfolio": true}'

# μ¬λ¬΄μ ν‘ λΉ„κµ API ν…μ¤νΈ
curl -X POST "http://localhost:8008/api/v2/financial/comparison" \
     -H "Content-Type: application/json" \
     -d '{"company_codes": ["005930", "000660"], "years": 3}'
```

### 5λ‹¨κ³„ μ„ν—μ„±ν–¥λ³„ νΉμ„±

| μ„ν—μ„±ν–¥ | μ£Όμ‹λΉ„μ¤‘ | λ‹¨μΌμΆ…λ©ν•λ„ | μ£Όμ”μ„Ήν„° | μ¬λ¬΄κΈ°μ¤€ |
|---------|----------|-------------|----------|----------|
| μ•μ •ν• | 5% | 5% | μ ν‹Έλ¦¬ν‹°, ν†µμ‹  | λ§¤μ¶ 1000μ–µ+, μμ—…μ΄μµλ¥  5%+ |
| μ•μ •μ¶”κµ¬ν• | 20% | 10% | κΈμµ, μ „κΈ°μ „μ | λ§¤μ¶ 500μ–µ+, μμ—…μ΄μµλ¥  3%+ |
| μ„ν—μ¤‘λ¦½ν• | 45% | 15% | ν™”ν•™, μλ™μ°¨, κ±΄μ„¤ | λ§¤μ¶ 100μ–µ+, μμ—…μ΄μµλ¥  0%+ |
| μ κ·Ήν¬μν• | 70% | 20% | λ°λ„μ²΄, IT, λ°”μ΄μ¤ | λ§¤μ¶ 50μ–µ+, μμ—…μ΄μµλ¥  -5%+ |
| κ³µκ²©ν¬μν• | 90% | 25% | νμ‹ κΈ°μ , μ‹ μ¬μƒμ—λ„μ§€ | μ ν• μ—†μ |

### λ°μ΄ν„° ν”λ΅μ°
```
μ‚¬μ©μ μ§λ¬Έ β†’ μ„ν—μ„±ν–¥ κ°μ§€ β†’ μ¬λ¬΄μ ν‘ μ¤ν¬λ¦¬λ‹ β†’ ν¬νΈν΄λ¦¬μ¤ μµμ ν™” β†’ AI μ„¤λ… μƒμ„±
     β†“              β†“                 β†“                β†“              β†“
ν‚¤μ›λ“ λ¶„μ„    5λ‹¨κ³„ λ¶„λ¥        DB μ‹¤μ  λ°μ΄ν„°      λ‹¨μΌμΆ…λ© ν•λ„    HyperCLOVA X
```

## π“ ν•µμ‹¬ νμΌ κµ¬μ΅°

```
portfolio-system/
β”β”€β”€ app/
β”‚   β”β”€β”€ services/
β”‚   β”‚   β”β”€β”€ portfolio_enhanced.py      # 5λ‹¨κ³„ μ„ν—μ„±ν–¥ + μ¬λ¬΄μ¤ν¬λ¦¬λ‹
β”‚   β”‚   β”β”€β”€ portfolio_explanation.py   # AI μ„¤λ… μƒμ„±
β”‚   β”‚   β”β”€β”€ financial_comparison.py    # μ¬λ¬΄μ ν‘ λΉ„κµ λ¶„μ„
β”‚   β”‚   β”β”€β”€ ai_agent.py                # AI μ—μ΄μ „νΈ
β”‚   β”‚   β”β”€β”€ stock_database.py          # λ°μ΄ν„°λ² μ΄μ¤ κ΄€λ¦¬
β”‚   β”‚   β””β”€β”€ investor_protection.py     # κΈμµμ†λΉ„μλ³΄νΈλ²• μ¤€μ
β”‚   β”β”€β”€ main.py                        # FastAPI μ„λ²„ (λ¨λ“  μ—”λ“ν¬μΈνΈ)
β”‚   β””β”€β”€ schemas.py                     # API μ¤ν‚¤λ§ μ •μ
β”β”€β”€ optimizer/
β”‚   β””β”€β”€ optimize.py                    # ν¬νΈν΄λ¦¬μ¤ μµμ ν™” μ—”μ§„
β”β”€β”€ etl/
β”‚   β”β”€β”€ load_yf.py                     # Yahoo Finance λ°μ΄ν„° μμ§‘
β”‚   β”β”€β”€ load_dart.py                   # DART μ¬λ¬΄μ ν‘ μμ§‘
β”‚   β””β”€β”€ load_krx.py                    # KRX λ°μ΄ν„° μμ§‘
β”β”€β”€ tests/
β”‚   β”β”€β”€ test_risk_profile_scenarios.py # μ„ν—μ„±ν–¥ ν…μ¤νΈ
β”‚   β”β”€β”€ test_financial_screening.py    # μ¬λ¬΄μ¤ν¬λ¦¬λ‹ ν…μ¤νΈ
β”‚   β””β”€β”€ test_user_questions.py         # μ‚¬μ©μ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ
β”β”€β”€ portfolio_ui.py                    # Streamlit UI
β”β”€β”€ environment.yml                    # Conda ν™κ²½μ„¤μ •
β””β”€β”€ README.md                          # μ΄ νμΌ
```

## μ£Όμ” νΉμ§•

### μ™„μ „ μλ™ν™”
- μ‚¬μ©μ μ§λ¬Έμ—μ„ μ„ν—μ„±ν–¥ μλ™ κ°μ§€
- μ¬λ¬΄μ ν‘ κΈ°λ° μλ™ μΆ…λ© μ¤ν¬λ¦¬λ‹
- λ‹¨μΌ μΆ…λ© ν•λ„ μλ™ μ¤€μ
- AI κΈ°λ° ν¬μ μ„¤λ… μλ™ μƒμ„±

### 100% μ‹¤μ  λ°μ΄ν„°
- λ¨μμ‘λ‹µμ΄λ‚ μ„μκ°’ μ‚¬μ© μ•ν•¨
- PostgreSQL DBμ μ‹¤μ  μ¬λ¬΄μ ν‘ λ°μ΄ν„°
- μ‹¤μ‹κ°„ μ£Όκ°€ λ° κΈ°μ—… μ •λ³΄
- DART API μ—°λ™ μ •ν™•ν• μ¬λ¬΄ μμΉ

###  κΈμµμ†λΉ„μλ³΄νΈλ²• μ¤€μ
- μ„ν—μ„±ν–¥λ³„ ν¬μ κ°€μ΄λ“λΌμΈ μ μ©
- ν¬μ μ„ν— κ³ μ§€ μλ™ ν¬ν•¨
- κ°μΈ ν¬μνλ‹¨ μ¤‘μ”μ„± κ°•μ΅°

##  μ„±κ³Ό μ§€ν‘

- **λ°μ΄ν„° μ™„μ„±λ„**: 100% (λ¨λ“  μΆ…λ© μ‹¤μ  DB λ°μ΄ν„°)
- **μ„ν—μ„±ν–¥ κ°μ§€ μ •ν™•λ„**: 95%+ (ν‚¤μ›λ“ κΈ°λ°)
- **λ‹¨μΌ μΆ…λ© ν•λ„ μ¤€μμ¨**: 100%
- **API μ‘λ‹µ μ‹κ°„**: ν‰κ·  2-3μ΄
- **μ¬λ¬΄μ ν‘ μ»¤λ²„λ¦¬μ§€**: KOSPI/KOSDAQ μ£Όμ” μΆ…λ© 100%
